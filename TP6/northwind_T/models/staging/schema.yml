version: 2

# -----------------
# 1. STAGING LAYER
# -----------------

sources:
  - name: staging_dlt
    schema: staging
    tables:
      - name: Customers
      - name: Orders

models:
  - name: stg_customers
    description: >
      Cleaned customer data from the Northwind 'Customers' table. 
      Includes renaming, basic type casting, and generation of the surrogate key.
    
    config:
      materialized: view

    columns:
      - name: customer_pk
        description: The primary key (PK) for the customer, generated using dbt_utils.surrogate_key.
        tests:
          - unique
          - not_null
          
      - name: customer_id
        description: The original source ID (CustomerID) from Northwind.
        tests:
          - unique
          - not_null
          
      - name: company_name
        description: The customer's company name.
      
      - name: contact_name
        description: The name of the primary contact person.
        
      - name: city
        description: The city where the customer is located.


  - name: stg_orders
    description: Cleaned order data from the Northwind 'Orders' table.
    config:
      materialized: view

    columns:
      - name: order_pk
        description: Surrogate key for the order record.
        tests:
          - unique
          - not_null
          
      - name: order_id
        description: Original source ID (OrderID) from Northwind.
        tests:
          - unique
          - not_null
          
      - name: customer_id
        description: Foreign key (FK) back to the Customers table.
        tests:
          # This ensures every order has a valid customer in the staging layer
          - relationships:
              to: ref('stg_customers') 
              field: customer_id
              
      - name: employee_id
        description: ID of the employee who took the order.
        # Note: You'd typically add a relationship test to a 'stg_employees' model here.

      - name: order_date
        description: The date the order was placed.
        tests:
          - not_null